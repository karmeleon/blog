---
layout: post
title: What determines the wild encounter rate in Pokemon Emerald?
date: 2020-4-1
---

![An encounter in Pokemon Emerald](/static/img/Pokemon/title.webp)
*Oh, come on.*

I was playing through Pokemon Emerald recently, but got _really_ turned off by the sheer volume of random encounters. It was way higher than I remembered as a wee elementary school kid, but I couldn't find any hard data on how the encounter rate was determined. Not even on [Bulbapedia](https://bulbapedia.bulbagarden.net/wiki/Main_Page), a Pokemon wiki with ridiculously detailed documentation of every possible aspect of every game.

That's when I stumbled upon a [GitHub project that hosts a disassembly of Pokemon Emerald](https://github.com/pret/pokeemerald). I can read code, I'm stuck inside indefinitely due to a global catastrophe, and I need something to do. Let's read some 16-year-old C code!
<!--more-->
### TL;DR

If all you care about is the final encounter rate, it's 1 in 9 (11%) for most outdoor land areas like tall grass and desert sand, 1 in 18 (6%) for most caves and the like, and 1 in 45 (2.2%) when Surfing. There are a bunch of modifiers to these figures, though, so read on if you care about those.

### Long Form

Hey, cool, you stuck around! Let's get into it. The entry point I'm using is [`StandardWildEncounter()` in `src/wild_encounter.c`](https://github.com/pret/pokeemerald/blob/f1cccc975baef9f000c24381c65bab31104e8c47/src/wild_encounter.c#L522) if you'd like to follow along. Huge thanks to all the community members who did the actual legwork of going from autogenerated, decompiled ASM to clean, formatted C with sane variable names. There's no way I could have done this without them.

First, if something is globally blocking all wild encounters, we don't generate one. Duh. I couldn't find anywhere in the code where this flag is set, though, so it's totally possible this is a leftover from a debug build or a scrapped feature.

If we haven't been globally blocked from encounters, we next try to handle the special cases: the [Battle Pike](https://bulbapedia.bulbagarden.net/wiki/Battle_Pike) and [Battle Pyramid](https://bulbapedia.bulbagarden.net/wiki/Battle_Pyramid). These broadly follow the same rules as normal wild encounters, but have special rules that affect the spawn list used and the level of the generated Pokemon. Bulbapedia does a great job of explaining how these work.

Now let's look at the rules for generating a "land battle", which is defined by a battle coming from a tile that can generate encounters, but isn't surfable. Examples of this are tall grass, caves, and the deep sand found in the desert on Route 111. Encounters generated by Surfing, Diving, Rock Smashing, Sweet Scent, and fishing use different sets of rules that we'll get into later.

The first interesting find is a line that checks if the player is walking onto encounter-generating terrain from some non-encounter-generating terrain. If this is true, we have a 40% chance to immediately skip generating an encounter. In other words, Game Freak have given us a free 40% chance to skip a wild Pokemon battle on our first step into grass!

### The Core Encounter Rate

If we didn't luck out on our first step check, we next move to the main encounter check. The first piece of the equation is the base encounter rate for the area. Most external areas' base encounter rate is `20` (think routes), and most internal areas' base rate is `10` (caves and other dungeons). Exceptions include the Safari Zone at `25`, Route 119 at `15`[^1], Seafloor Cavern and Cave of Origin at `4`, and the mostly-unused Altering Cave at `7`.

This rate is first multiplied by `16`. I imagine this is done so that all the following modifiers will actually have an effect, since some of the base encounter rates are odd or small. In order, all these modifiers are applied:

| Modifier                                                | Multiplier |
|---------------------------------------------------------|------------|
| Being on a bike                                         | 80%        |
| Having played the White Flute                           | 150%       |
| Having played the Black Flute                           | 50%        |
| Lead Pokemon has a Cleanse Tag                          | 66%        |
| Lead Pokemon has the Stench ability (in Battle Pyramid) | 75%        |
| Lead Pokemon has the Stench ability (everywhere else)   | 50%        |
| Lead Pokemon has the Illuminate ability                 | 200%       |
| Lead Pokemon has the White Smoke ability                | 50%        |
| Lead Pokemon has the Arena Trap ability                 | 200%       |
| Lead Pokemon has the Sand Veil ability in a sandstorm   | 50%        |

The resulting value is capped at `2880`. A value is randomly generated in the range `[0, 2880)` and compared to the modified encounter rate. If the encounter rate is greater than the randomly-generated number, the game continues to the next step. Otherwise, we're safe.

Some observations from this function:

* Holy crap, being on a bike actually reduces the encounter rate a bit! You'll end up having more encounters per minute because you're going faster, but if you want to get from point A to point B with as few battles as possible, a bike is the way to go.
* Running doesn't affect the encounter rate, at least not in Emerald. Apparently later games change this.
* The lead Pokemon's held item and ability takes effect even if it's fainted.
* Stench has a reduced effect in the Battle Pyramid, but White Smoke doesn't. Even though White Smoke has an effect in battle and Stench doesn't. Maybe Game Freak just felt bad for poor Torkoal (the only Pokemon with White Smoke in Gen 3).
* If you're in the Safari Zone playing a White Flute, and your lead Pokemon has the Illuminate ability, your modified encounter rate would be `1200`, giving you a brutal 1 in 2.4 (41%) chance to encounter a wild Pokemon per step.
* On the other hand, playing the Black Flute while biking through the Cave of Origin with a lead Pokemon with the Stench ability and a Cleanse Tag will give you a modified rate of `8`, or a 1 in 360 (0.27%) chance.
* The same setup in a normal tall grass area gives a modified rate of `42`, or 1 in 69[^2] (1.4%), while doing it in a cave would give you `21`, or 1 in 137 (0.7%). Or, instead of being a reeking, flute-playing cyclist, y'know, use a Repel. (More on those later.)

### Choosing What to Fight

If we've gotten this far, the game has decided that it wants us to fight _something_, but hasn't decided what yet. There are three different types of wild encounters the game can throw at you: roamers, mass outbreaks, and normal encounters.

In Emerald, Latios and Latias roam around the world after defeating the Elite Four for the first time. If they're in your area, the game tries to start a battle with them first, with a 25% chance to succeed. Passing the check means it's time to break out the Sleep Powder and Quick Balls, 'cuz it's Latixs-catching time! That is, unless you're wearing a Repel and the first conscious, non-egg Pokemon in your party is a higher level than the roamer. In that case the game gives up on generating an encounter for this step and you'll continue on your way unmolested by Trainerless Pokemon.

If we didn't get lucky and pass the roamer check, the game next looks for [mass outbreaks](https://bulbapedia.bulbagarden.net/wiki/Pok%C3%A9mon_outbreak#Generation_III). These are events announced on TV that cause a 50% chance to encounter a specific species of Pokemon, at a specific level, on a specific Route, for the rest of the day after the program is watched. Passing the roll will start a battle with a Pokemon of the specified species and level, assuming you pass a Repel check. The rest of the stats will be randomly determined in the same way as a normal wild Pokemon.

If we're still looking for a wild Pokemon to face, the game tries to generate one from the area's encounter table. The encounter table for an area includes a list of the Pokemon that can appear in the area, the range of levels they can be found at, and the percent chance they have to be selected from the table. They're all [readily available on Bulbapedia](https://bulbapedia.bulbagarden.net/wiki/Hoenn_Route_120#Generation_III) if you're looking for a specific 'mon. In most cases, the game randomly chooses a species and level from this table, then generates IVs, a gender, and a nature.

But this is Pokemon, so naturally there are a ton of modifiers to this otherwise-simple procedure. First, the game checks if the lead Pokemon has Magnet Pull or Static as its ability. If so, the game has a 50% chance to choose a Steel- or Elecric-type Pokemon from the encounter table. Otherwise, it chooses randomly from the weighted table.

Next, it generates a level. Usually this level is uniformly distributed within the range for the area for that species, but if the lead Pokemon has Pressure, Vital Spirit, or Hustle, there's a 50% chance to immediately choose the highest value in the range.

Our encounter is almost ready! Now the game does another Repel check, followed by the "Discount Repel" ability check. If the lead Pokemon has Pressure, Intimidate, or Keen Eye and the generated level is at least 5 less than the lead's own level, there's a 50% chance the encounter is scrapped for this step. Interestingly, the roamer and mass outbreak routines include the Repel check, but skip the ability check.

If we haven't repelled the Pokemon in one way or another, the game finally generates the rest of the wild Pokemon's parameters. The IVs are totally random, but the gender and nature are not in certain cases. If the lead Pokemon has the Cute Charm ability, there's a 66% chance to generate the wild 'mon with the opposite gender of the lead if the chosen species can be that gender. In the Safari Zone, a nearby filled Pokeblock feeder has an 80% chance to cause the generated Pokemon to have a nature that would like the Pokeblock in the feeder. Finally, a lead with the Synchronize ability will give a 50% chance to generate a Pokemon with the same nature as the lead.

At long last, our rival has been determined, and the battle begins. Whew.

### What About the Other Battle Types?

They're broadly similar to land battles. I'll cover them rapid-fire, only mentioning the ways in which they differ.

#### Surfing

* If Groudon and Kyogre are fighting in Sootopolis, there are no random encounters there.
* The base encounter rate of all water is `4`, except in the Safari Zone where it's `9`. This gives encounter rates of 1 in 45 (2.2%) and 1 in 20 (5%), respectively.
* If you could somehow be on your bike in the water, it'd still reduce the encounter rate. All the other encounter rate modifiers are still in play, too.
* Surfing has its own encounter table in each area.
* Mass outbreaks don't occur, but you can still encounter the roamer.
* Magnet Pull has no effect, but Static still applies.[^3] 

#### Diving

* Identical to Surfing, including the `4` base encounter rate, except:
* Diving areas are totally separate from the routes under which they exist, so they have their own encounter tables.
* Can only trigger battles while in seaweed.
* Do not ask me how you can apply Repel underwater, but it still works.
* The code exists to encounter the roamer underwater, but it's never programmed to go there. This is an artifact of code reuse, not a scrapped event where Latios would appear when Diving.

#### Rock Smash

* Has its own encounter table.
* Either `20` or `25` base encounter rate, depending on the area.
* The encounter rate calculation ignores abilities, but bikes, flutes, and Cleanse Tag still apply.
* Mass outbreaks and roamers won't appear.
* Magnet Pull and Static have no effect.[^4]

#### Sweet Scent

* If you're on an encounter-generating tile when using Sweet Scent outside of battle, and the legendary battle in Sootopolis doesn't apply, you will get a battle regardless of Repel, abilities, etc.
* Uses the encounter table and logic of the terrain the player is standing on, including mass outbreaks and roamers.

#### Fishing

* Instead of a normal encounter rate calculation, there's a minigame to determine if an encounter occurs. It's pretty complicated, so maybe I'll dig into that in another post.
* If the player wins the minigame and is fishing into a tile that might contain a Feebas, there's a 50% chance to encounter one. Finding Feebas is also complicated, but [Bulbapedia has a good article on it](https://bulbapedia.bulbagarden.net/wiki/Hoenn_Route_119#Finding_Feebas).
* Otherwise, the game randomly chooses from the weighted list of species that corresponds to the rod used for the area, just like it would for land encounters.
* You'll never hook a roamer or a mass encounter Pokemon.

Overall, I had fun looking through the code! I've never looked at game code before, and I was pleasantly surprised how readable it ended up being. Maybe if something else in my playthrough frustrates me, I'll dig back in :)

[^1]: I believe this route is special since it's pretty lengthy and full of long stretches grass you can't walk around.
[^2]: nice
[^3]: There are no Steel types in any of the water encounter lists, and the only electric type is Chinchou (found only underwater).
[^4]: There aren't any Steel or Electric types in the Rock Smash encounter lists anyway.
